<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <textarea name="" id="" cols="30" rows="10" class="input">\..................-..........................-............................................-...-.............|
        ..........-........//....../...-....../.....|...............................|.............-.....-.............
        ..\....\............./...\.......\/.................................................../................-......
        |...................................................\...................|...||-..............|................
        .....\.................\.........................|-.....|.........-.\...............-.........|....\.......\..
        .....\.......|.-...................|.............|...................................................-........
        \..............|............-......-.....|........................-..........--................./..\..........
        ..................../.\|..|.......\.-..........|..\..../.-..\/.................-.............................\
        ..\...........|.......\............./..................|...|................../......|.........|.........-....
        .\...........|.........|....-....../..................\.................................|.....\...............
        ...............\../......-.............|......./.......-/...-............................|..|.................
        .......\.........................-.........-.|......\../.-......-........../................................/.
        .........|............./..-.........\.....-\.........................|..|.........................-...\.......
        .\..............|.............../...........................................|......-./........................
        ...............\........-......-........\............................../|.\....\...../..-......-.....\.....\..
        ...........................\..../.......................-............./\../.|...../..--.......\......-........
        ........|...................................\....-.....|........./.........\....-..........-......./..........
        .........|...\.........-....\/......\............\-.-......|....................................../-..........
        .../........../...-...|......./......................\.........../.............../.......\....................
        ..................././/....................|......-...........-........-........\..........|....|.............
        ..\..-../.|............/...............................\-.../...-../...\.......|............/...|.............
        ............../.....................................\.......-.....................................-....../....
        .........................|..\....................|\..|.................\-..........-......................../.
        .-.....................\....................|...........................-../........../........|.......-......
        .../...................|..-|..|-......................|.\........|\.\...../......-................../...-.....
        -\/...............\.........-..../.....\.......|....|..........|..........|....................../..........|.
        ../.../................\......|............\/...|.............../............................||...............
        ................\....-\./....\...\.......................|....|.....-.-..........-|...../....|................
        ..............\.............................../..........|...............-./............/...........\.-.....-|
        ...............-.../......-....|.....................................-............/..-...........-\|..........
        ......|-..............................................//./........./\..............-........./|...............
        ..........\........|.........|..../..\........|.....................-....\\-.........................|./......
        ......-................-\..-.....\........../...\....................../....-...|........./........\|........-
        ........../.........../.\...................|..........|.-.......\.....|...............-........../...........
        ..........\../........................|........./........-.....|........................-.../...........-....-
        ..................../...........................|...|.\.............\......-........|............\.......\....
        -....-/...................\................|....-..|.............................-...|........................
        .........\.................|.\........|...-................|....................../......................-....
        .......|..-.....\...........\.........../.......\..|..............................\.....................\.....
        /......|...-..............|..|.......\.\...|.......||...-...............|....../.........\.....\./............
        ....-.-../..\../......\\/......................|....|..................../....|.\.........................|...
        ...-..................|.-......................\\\.................//..-............|........./...\..-........
        .........................\.....-/|....|../............|...-.......\./.............\.........|.................
        ../.................../..../......./..........-.....................................-..-.--.....|.........\...
        .\........................-\........../....|..................-........\...........\............./............
        .........................-...|......|-.............................................../...|-.............../...
        ............/.|.........-../.........................|......-..............-...|..--.........................\
        ..|...............\.......\..-................\.........................|/...--.....\..\........\\........\...
        ........-....../........-................/.......\/......-.............................|...........-..\.......
        .-..|......................../...........-......\...........|..|.............\................................
        |..........|..\....\..............-...../.\.|-...................|......|............|...\..........|...|\....
        .-............-/.-.........-..................................|.../........................\..................
        .........-.....-.......|........../...........-/.........\.........../-./..-.............................|....
        .........................................../...|.|.........../..-...........|....../...|\........-......./....
        ......................--|.....................\-................./..|............./...........................
        ...............................././......\...-.........|..|.........\|.../.-/....-........|........|..........
        .........-.../..../................../...-.........../..................../..../|/.........|..................
        ..\...\....-.-.....................................................\......--.......\.....|............/.......
        \.........../......\..............-....-...........\........||................./../......./........\..........
        ...............||..-..........-............\........../|.............................-.../-...................
        ......../.............|....................|-.|...\...-..........................................-............
        .........\.../........-..........................................................-.....................|......
        ....\|................/.......\................/............./.-..|...\........-............../-..\...........
        ....................\.....-.........-..|.......\..../.|...-......................|....|.......................
        ..................................|.|...................-|......................\............|................
        ............-/......................|................\.............-.....................\...............-....
        ......................../....-.......\.\.....|....-...................-...............\......................\
        ......|.........................../.............................../.........\.................................
        ......\-.........../........\...........-.......-........|.....\../.....-.../..............\......\./.........
        ...|.....\......|..........-.-\......-..-../...................|................./..../............-.........|
        ......|.............|/........|....\...-...................../.........|...-..........\.............-.........
        ...........................--..........\.......................................-......|.......|...............
        ..\......|..............|.........................................|............../.|...........-......|.......
        .......................................|......-....................................|.......\.-................
        |......./..\.|............................/....../..............-.|...\..../.../.....-........................
        ...../..../.....\................................-...|......................./...|..............|.........|...
        ......-/....../-.............-.......-../-....\.....................\.........................................
        ..|.../.|.|......................-....../..--.....|\............./......................./................\...
        ................/..........\...................../...........\.....-/............|........\..................\
        .-....................-........-........./..............................\.........../..................\\.....
        ..........-......../..||........|........-|.....\.....................\.......|............\.....\........-...
        ....-|../...................../.\.-...................../.................|............\...|../...............
        ......../..................../.....|.....-\././..\............\....\........../...|.....\.....|......./.......
        ........\................|.....|......\.-............................\..........|...........|.................
        ../............/.........-...................|./............../...........|.../-..-./..............\....-.....
        ...-...-....|\.......-..../...|................\...\.........../.......-.....-..../....|......................
        ....\.........-............|....\.......|................................|.....|......../....\.....\..........
        ......-......|.../-......./.........................\..|\/.........-../..............|..-...............\..\..
        .............../............-................................-......-......./............|....................
        ....\........../................\....|..........|...............-...|.................-......-...........-....
        ....\.....|..................\..............\...............././...-../...........\/..........................
        .........................../.................-.................-......\.....................................\.
        ................|/......../.....-.........................../....\...........|..........-.......|.|........./.
        ......./......|.\............\............................/.....-........\.............../.|..................
        .../......./......|.......|.................................................\.....\................/|.........
        ............../....../...|...\.................................\.........|/...|.\....-...............\-/......
        ......\..--.|.........-.|......................-....................-...........-..|-......................./.
        ................/...../.\.../......|.............................../.\...-./.......-|......|.|................
        .....\./..........-....\..-..|...\..........-...|.....-......|.......\......|.|..........................-....
        ......../....|.........../.....\.....|........./.|..................\....|......-....\............/........../
        ....../.....|..|...../.............|.......|/......-....|......|..../..........-..................|.........\.
        ...-..|.../.......-......-....................-.....\.....|...-..../............\..........................\..
        ...\..\|....|\|-.................../...../......-.-/\.........................-.........-.............|...|...
        .\.....|........................-.\...\....|............../.-...................................../-..|.\....|
        ..\.......................|...-...\...-.........../.......................\.........................|.../.....
        ....\.....|...-............../...-.|............/.-........\..-....\.....|................../..........\......
        ..................................|..-.................\..............\..................................-|...
        .........................\.........../.-/.|............|...........-.........../...../.\|..\.../.....|...-....
        ..........\.........-.-../-......-..\.......|.............-........|..............................\.....\.....
        ..\.........../........|..-...-..............|./....................\.........\..........|....-...............</textarea>
    <button class="button">Go</button>
    <div class="final"></div>
    <div class="display" style="font-family: monospace;"></div>
</body>
<script>
    let input = document.querySelector(".input")
    let button = document.querySelector(".button")
    let final = document.querySelector(".final")
    let display = document.querySelector(".display")
    let cache = new Map()
    let rows = []
    let history = []
    let n = 0
    
    function refresh() {
        let largest = 0
        let energized = []
        rows = input.value.split("\n").map(l => {return l.trim()})
        cache = new Map()
        let finalEnergized = []

        for (let i = 0; i < rows.length; i++) {
            history = []
            energized = UiBeeeeeeaaaaaaam([`-1,${i}`, "right"])
            if (energized.length > largest) {
                largest = energized.length
                finalEnergized = energized
            }
            history = []
            energized = UiBeeeeeeaaaaaaam([`${rows[0].length},${i}`, "left"])
            if (energized.length > largest) {
                largest = energized.length
                finalEnergized = energized
            }
        }

        for (let i = 0; i < rows[0].length; i++) {
            history = []
            energized = UiBeeeeeeaaaaaaam([`${i},-1`, "down"])
            if (energized.length > largest) {
                largest = energized.length
                finalEnergized = energized
            }
            history = []
            energized = UiBeeeeeeaaaaaaam([`${i},${rows.length}`, "up"])
            if (energized.length > largest) {
                largest = energized.length
                finalEnergized = energized
            }
        }

        let displayGrid = []

        for (let i = 0; i < rows.length; i++) {
            let row = []
            for (let j = 0; j < rows[0].length; j++) {
                row.push(".")
            }
            displayGrid.push(row)
        }

        for (const c of finalEnergized) {
            let coords = c.split(",")
            let x = parseInt(coords[0])
            let y = parseInt(coords[1])

            displayGrid[y][x] = "#"
        }


        final.innerHTML = largest
        display.innerText = displayGrid.map(l => {return l.join("")}).join("\n")
    }

    function UiBeeeeeeaaaaaaam(beam) {
        debugger
        let joinedBeam = beam.join(";")
        if (cache.has(joinedBeam)) return cache.get(joinedBeam)
        else cache.set(joinedBeam, [])

        let energized = []
        let keepGoing = true


        while (keepGoing) {
            let coords = beam[0].split(",")
            let direction = beam[1]
            let x = parseInt(coords[0])
            let y = parseInt(coords[1])
            energized.push(coords.join(","))
            switch (direction) {
                case "left":
                    x--
                    break;
                case "right":
                    x++
                    break;
                case "up":
                    y--
                    break;
                case "down":
                    y++
                    break;
                default:
                    break;
            }
            
            if (x < 0 || y < 0 || x >= rows[0].length || y >= rows.length) {
                break
            }

            let tile = rows[y][x]
            let newCoords = `${x},${y}`
            let oriDirection = direction

            switch (tile) {
                case "/":
                    switch (direction) {
                        case "left":
                            direction = "down"
                            break;
                        case "right":
                            direction = "up"
                            break;
                        case "up":
                            direction = "right"
                            break;
                        case "down":
                            direction = "left"
                            break;
                        default:
                            break;
                    }
                    break;
                case "\\":
                    switch (direction) {
                        case "left":
                            direction = "up"
                            break;
                        case "right":
                            direction = "down"
                            break;
                        case "up":
                            direction = "left"
                            break;
                        case "down":
                            direction = "right"
                            break;
                        default:
                            break;
                    }
                    break;
                case "|":
                    if (direction == "left" || direction == "right") {
                        direction = "up"
                        energized = energized.concat(UiBeeeeeeaaaaaaam([newCoords, "down"]))
                    }
                    break;
                case "-":
                    if (direction == "up" || direction == "down") {
                        direction = "left"
                        energized = energized.concat(UiBeeeeeeaaaaaaam([newCoords, "right"]))
                    }
                    break;
            }
            history.push(beam.join(','))

            if (direction != oriDirection) {
                energized = energized.concat(UiBeeeeeeaaaaaaam([newCoords, direction]))
                energized.push(newCoords)
                break
            }
            if (history.includes(`${newCoords},${direction}`)) break
            else beam = [newCoords, direction]
        }

        energized.shift()
        energized = [...new Set(energized)]
        cache.set(joinedBeam, energized)
        return energized
    }
    
    button.addEventListener("click", refresh)
</script>
</html>